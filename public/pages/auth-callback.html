<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <title>Ingresando...</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="h-screen overflow-hidden flex flex-col bg-slate-950 text-slate-100">
  <header id="appShellTop"></header>

  <main class="flex-1 overflow-y-auto p-4 pb-24">
    <div class="rounded-xl border border-slate-800 bg-slate-900 p-4 text-slate-200">Ingresando...</div>
  </main>

  <nav id="appShellBottom"></nav>

  <script type="module">
    import { supabase } from "/js/supabase-client.js";
    import { initAppShell } from "/js/app-shell.js";

    initAppShell({
      title: "Ingresando",
      onRefresh: async () => location.reload()
    });

    const next = new URLSearchParams(location.search).get("next");
    const fallbackTarget = "/index.html";
    const target = next ? decodeURIComponent(next) : fallbackTarget;

    const { data } = await supabase.auth.getSession();
    if (data?.session) {
      location.replace(target);
    } else {
      const { data: sub } = supabase.auth.onAuthStateChange((_event, session) => {
        if (session) {
          sub.subscription.unsubscribe();
          location.replace(target);
        }
      });

      setTimeout(() => location.replace(target), 2000);
    }
  </script>
</body>
</html>


