<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#F7F8FA" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="JyP Ventas">
  <link rel="apple-touch-icon" href="/assets/icons/icon-192.png">
  <link rel="manifest" href="/manifest.webmanifest" />
  <title>Producto</title>
  <script src="/js/vendor/tailwindcss-playcdn.js"></script>
  <link rel="stylesheet" href="/css/theme.css" />
</head>

<body class="h-screen overflow-hidden flex flex-col">
  <header id="appShellTop"></header>

  <main class="flex-1 overflow-y-auto p-4 space-y-4 pb-24">
    <img id="img" class="w-full h-56 object-contain rounded-2xl border divider bg-surface" alt="" />

    <section class="card p-4 space-y-3">
      <h1 id="name" class="text-xl font-semibold leading-tight"></h1>
      <div id="price" class="text-2xl font-bold text-primary"></div>
      <div id="category" class="text-muted text-sm"></div>
      <button id="btnAddCart" class="btn btn-primary w-full">
        <span class="flex items-center justify-center text-emerald-600">
          <svg viewBox="0 0 24 24" class="w-6 h-6 stroke-[1.8]" fill="none" stroke="currentColor" aria-hidden="true">
            <path d="M12 5v14"></path>
            <path d="M5 12h14"></path>
          </svg>
        </span>
        <span>Agregar al carrito</span>
      </button>
    </section>

    <section class="card p-4">
      <h2 class="text-sm font-semibold mb-2">Descripcion</h2>
      <p id="desc" class="text-muted text-sm leading-relaxed"></p>
    </section>

    <section class="card p-4 space-y-3">
      <h2 class="text-sm font-semibold">Acciones rapidas</h2>
      <div class="grid grid-cols-4 gap-2">
        <button id="btnEditProduct" class="btn btn-secondary px-3 py-3 inline-flex items-center justify-center" aria-label="Modificar producto" title="Modificar producto">
          <span class="flex items-center justify-center">
            <svg viewBox="0 0 24 24" class="w-5 h-5 stroke-[1.8]" fill="none" stroke="currentColor" aria-hidden="true">
              <path d="M12 20h9"></path>
              <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4Z"></path>
            </svg>
          </span>
        </button>

        <button id="btnShare" class="btn btn-secondary px-3 py-3 inline-flex items-center justify-center" aria-label="Compartir producto" title="Compartir producto">
          <span class="flex items-center justify-center">
            <svg viewBox="0 0 24 24" class="w-5 h-5 stroke-[1.8]" fill="none" stroke="currentColor" aria-hidden="true">
              <circle cx="18" cy="5" r="3"></circle>
              <circle cx="6" cy="12" r="3"></circle>
              <circle cx="18" cy="19" r="3"></circle>
              <path d="M8.6 13.5 15.4 17.5"></path>
              <path d="M15.4 6.5 8.6 10.5"></path>
            </svg>
          </span>
        </button>

        <button id="btnCopy" class="btn btn-secondary px-3 py-3 inline-flex items-center justify-center" aria-label="Copiar enlace" title="Copiar enlace">
          <span class="flex items-center justify-center">
            <svg viewBox="0 0 24 24" class="w-5 h-5 stroke-[1.8]" fill="none" stroke="currentColor" aria-hidden="true">
              <rect x="9" y="9" width="13" height="13" rx="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
          </span>
        </button>

        <button id="btnDownload" class="btn btn-secondary px-3 py-3 inline-flex items-center justify-center" aria-label="Descargar imagen" title="Descargar imagen">
          <span class="flex items-center justify-center">
            <svg viewBox="0 0 24 24" class="w-5 h-5 stroke-[1.8]" fill="none" stroke="currentColor" aria-hidden="true">
              <path d="M12 3v12"></path>
              <path d="M7 10l5 5 5-5"></path>
              <path d="M5 21h14"></path>
            </svg>
          </span>
        </button>
      </div>
    </section>
  </main>

  <div id="productEditModal" class="hidden fixed inset-0 z-50 overlay-backdrop p-4">
    <div id="productEditModalDialog" class="card max-w-md w-full mx-auto mt-8 p-4 space-y-3">
      <div class="flex items-center justify-between">
        <h2 class="text-sm font-semibold">Modificar producto</h2>
        <button id="btnCloseEditModal" type="button" class="icon-btn !w-8 !h-8" aria-label="Cerrar">X</button>
      </div>

      <div>
        <label for="editName" class="block text-xs text-muted mb-1">Nombre</label>
        <input id="editName" class="input" />
      </div>

      <div>
        <label for="editPrice" class="block text-xs text-muted mb-1">Precio</label>
        <input id="editPrice" type="number" min="0" step="1" class="input" />
      </div>

      <div>
        <label for="editDescription" class="block text-xs text-muted mb-1">Descripcion</label>
        <textarea id="editDescription" rows="3" class="input"></textarea>
      </div>

      <div>
        <label for="editImagePath" class="block text-xs text-muted mb-1">Ruta imagen (image_path)</label>
        <input id="editImagePath" class="input" placeholder="products/imagen.jpg" />
      </div>

      <div class="flex gap-2">
        <button id="btnSaveProduct" class="btn btn-primary flex-1">Guardar cambios</button>
        <button id="btnCancelEdit" class="btn btn-secondary">Cancelar</button>
      </div>
    </div>
  </div>

  <nav id="appShellBottom"></nav>

  <script type="module">
    import { requireAuth } from "/js/auth.js";
    import { registerServiceWorker, applyUpdate } from "/js/sw-register.js";
    import { initProductPage } from "/js/product-page.js";
    import { initAppShell } from "/js/app-shell.js";

    const session = await requireAuth();
    if (!session) throw new Error("Redirecting to login...");

    let pendingReg = null;

    initAppShell({
      title: "Producto",
      onRefresh: async () => location.reload()
    });

    registerServiceWorker({
      onUpdate: (reg) => {
        pendingReg = reg;
        document.getElementById("updateBanner")?.classList.remove("hidden");
      }
    });

    document.getElementById("btnUpdate").addEventListener("click", () => applyUpdate(pendingReg), { once: true });

    initProductPage();
  </script>
</body>
</html>
